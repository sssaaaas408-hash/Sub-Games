<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web SubGames</title>
    <link rel="icon" type="image/png" href="SubGames_curva.png">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --secondary-text: #8e8e93;
            --input-bg: #f2f2f7;
            --border-color: #d1d1d6;
            --hover-bg: #e5e5ea;
            --accent-color: #007aff;
        }
        body.dark-mode {
            --bg-color: #000000;
            --text-color: #ffffff;
            --secondary-text: #98989d;
            --input-bg: #1c1c1e;
            --border-color: #38383a;
            --hover-bg: #2c2c2e;
            --accent-color: #0a84ff;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: var(--bg-color); color: var(--text-color); min-height: 100vh; transition: background-color 0.3s, color 0.3s; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; border-bottom: 0.5px solid var(--border-color); backdrop-filter: blur(20px); background: var(--bg-color); }
        .logo { font-size: 20px; font-weight: 600; display: flex; align-items: center; gap: 8px; text-decoration: none; color: var(--text-color); }
        .logo-icon { width: 32px; height: 32px; border-radius: 7px; object-fit: cover; }
        .nav-desktop { display: flex; gap: 24px; align-items: center; }
        .nav-desktop a { color: var(--text-color); text-decoration: none; font-size: 15px; font-weight: 400; transition: opacity 0.2s; opacity: 0.6; }
        .nav-desktop a:hover { opacity: 1; }
        .nav-desktop a.active { opacity: 1; font-weight: 500; }
        .theme-toggle { width: 51px; height: 31px; background: var(--input-bg); border-radius: 16px; cursor: pointer; position: relative; transition: background 0.4s; border: 1px solid var(--border-color); }
        .theme-toggle-slider { width: 27px; height: 27px; background: white; border-radius: 50%; position: absolute; top: 1px; left: 1px; transition: all 0.4s; box-shadow: 0 2px 8px rgba(0,0,0,0.12); }
        body.dark-mode .theme-toggle { background: #34c759; border-color: #34c759; }
        body.dark-mode .theme-toggle-slider { transform: translateX(20px); background: #ffffff; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
        .hamburger { display: none; flex-direction: column; gap: 5px; cursor: pointer; }
        .hamburger span { width: 22px; height: 2px; background: var(--text-color); transition: all 0.3s; border-radius: 1px; }
        .nav-mobile { display: none; position: fixed; top: 65px; left: 0; right: 0; background: var(--bg-color); border-bottom: 0.5px solid var(--border-color); padding: 8px; z-index: 1000; }
        .nav-mobile.active { display: block; }
        .nav-mobile a { display: block; padding: 12px 16px; color: var(--text-color); text-decoration: none; border-radius: 8px; font-size: 15px; }
        .nav-mobile a:hover { background: var(--hover-bg); }
        .main-content { max-width: 1200px; margin: 0 auto; padding: 60px 24px; display: grid; grid-template-columns: 1fr 300px; gap: 40px; transition: grid-template-columns 0.4s; }
        body:has(.popular-section.collapsed) .main-content { grid-template-columns: 1fr 60px; }
        .content-left { min-width: 0; }
        .sidebar { position: sticky; top: 80px; height: fit-content; transition: all 0.4s; }
        .popular-section { background: var(--input-bg); border-radius: 16px; padding: 0; overflow: hidden; transition: all 0.4s; width: 300px; }
        .popular-section.collapsed { width: 60px; }
        .popular-section.collapsed .popular-content { max-height: 0; opacity: 0; padding: 0 20px; }
        .popular-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; cursor: pointer; user-select: none; transition: all 0.4s; }
        .popular-section.collapsed .popular-header { padding: 16px; justify-content: center; flex-direction: column; }
        .popular-header:hover { background: var(--hover-bg); }
        .popular-title { font-size: 15px; font-weight: 600; transition: all 0.4s; white-space: nowrap; }
        .popular-section.collapsed .popular-title { opacity: 0; filter: blur(10px); font-size: 0; margin: 0; }
        .toggle-arrow { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; color: var(--secondary-text); transition: transform 0.4s; font-size: 18px; }
        .popular-section.collapsed .toggle-arrow { transform: rotate(180deg); }
        .popular-content { max-height: 1000px; opacity: 1; padding: 0 20px 16px; transition: max-height 0.4s, opacity 0.3s, padding 0.3s; }
        .popular-list-grid { display: grid; grid-template-columns: 1fr; gap: 6px; transition: all 0.4s; }
        .popular-item { display: flex; align-items: center; gap: 10px; padding: 10px; border-radius: 8px; cursor: pointer; transition: all 0.3s; background: transparent; }
        .popular-item:hover { background: var(--hover-bg); transform: translateY(-1px); }
        .popular-rank { font-size: 16px; font-weight: 700; color: var(--secondary-text); min-width: 20px; transition: all 0.3s; }
        .popular-image { width: 50px; height: 23px; border-radius: 4px; object-fit: cover; background: var(--border-color); transition: all 0.3s; }
        .popular-info { flex: 1; min-width: 0; transition: all 0.3s; }
        .popular-name { font-size: 13px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.3; transition: all 0.3s; }
        .popular-downloads { font-size: 11px; color: var(--secondary-text); margin-top: 2px; transition: all 0.3s; }
        .page-header { margin-bottom: 32px; }
        .page-header h1 { font-size: 34px; font-weight: 700; margin-bottom: 8px; letter-spacing: -0.5px; }
        .page-header p { color: var(--secondary-text); font-size: 17px; }
        .search-bar { margin-bottom: 24px; }
        .search-input { width: 100%; padding: 12px 16px; background: var(--input-bg); border: 1px solid var(--border-color); border-radius: 12px; font-size: 15px; color: var(--text-color); transition: all 0.2s; }
        .search-input:focus { outline: none; border-color: var(--accent-color); background: var(--bg-color); }
        .categories-section { margin-bottom: 32px; }
        .categories-scroll { display: flex; gap: 8px; overflow-x: auto; padding: 4px 0; scrollbar-width: thin; }
        .categories-scroll::-webkit-scrollbar { height: 6px; }
        .categories-scroll::-webkit-scrollbar-track { background: var(--input-bg); border-radius: 3px; }
        .categories-scroll::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
        .category-chip { padding: 8px 16px; background: var(--input-bg); border: 1px solid var(--border-color); border-radius: 20px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s; white-space: nowrap; display: flex; align-items: center; gap: 6px; }
        .category-chip:hover { background: var(--hover-bg); transform: translateY(-1px); }
        .category-chip.active { background: var(--accent-color); color: white; border-color: var(--accent-color); }
        .category-count { font-size: 12px; opacity: 0.8; font-weight: 400; }
        .category-chip.active .category-count { opacity: 1; }
        .ids-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; transition: all 0.4s; }
        .id-card { background: var(--input-bg); border-radius: 16px; overflow: hidden; transition: all 0.4s; cursor: pointer; position: relative; }
        .id-card:hover { background: var(--hover-bg); transform: translateY(-2px); }
        .game-image { width: 100%; height: 140px; object-fit: cover; background: linear-gradient(135deg, var(--border-color) 0%, var(--input-bg) 100%); transition: height 0.4s; }
        .card-content { padding: 20px; transition: padding 0.4s; }
        .id-name { font-size: 17px; font-weight: 600; margin-bottom: 6px; line-height: 1.3; transition: font-size 0.4s; }
        .id-number { font-size: 13px; color: var(--secondary-text); font-family: 'SF Mono', 'Monaco', 'Courier New', monospace; margin-bottom: 8px; }
        .id-description { font-size: 13px; color: var(--secondary-text); line-height: 1.4; margin-top: 8px; }
        .category-badge { display: inline-block; font-size: 11px; padding: 4px 8px; background: var(--accent-color); color: white; border-radius: 6px; margin-top: 8px; margin-right: 4px; font-weight: 500; }
        .download-label { font-size: 13px; color: var(--accent-color); margin-top: 12px; display: inline-block; }
        .loading, .error, .no-results { text-align: center; padding: 60px 20px; color: var(--secondary-text); font-size: 17px; grid-column: 1 / -1; }
        .error { color: #ff3b30; background: var(--input-bg); border-radius: 16px; }
        footer { text-align: center; padding: 32px 24px; color: var(--secondary-text); font-size: 13px; border-top: 0.5px solid var(--border-color); margin-top: 80px; }
        .info-notices { background: var(--input-bg); border-radius: 12px; padding: 16px; margin-bottom: 16px; border: 1px solid var(--border-color); transition: all 0.4s; }
        .notice-item { display: flex; align-items: flex-start; gap: 12px; padding: 10px; border-radius: 8px; transition: all 0.4s; }
        .notice-item:not(:last-child) { margin-bottom: 8px; padding-bottom: 16px; border-bottom: 1px solid var(--border-color); }
        .notice-icon { font-size: 18px; line-height: 1; flex-shrink: 0; transition: all 0.4s; }
        .notice-text { font-size: 13px; line-height: 1.5; color: var(--text-color); opacity: 0.85; transition: all 0.4s; }
        .discord-link { color: var(--accent-color); text-decoration: none; font-weight: 500; transition: opacity 0.2s; }
        .discord-link:hover { opacity: 0.7; text-decoration: underline; }
        @media (max-width: 768px) {
            .nav-desktop { display: none; }
            .hamburger { display: flex; }
            .page-header h1 { font-size: 28px; }
            .main-content { padding: 40px 20px; grid-template-columns: 1fr; }
            .sidebar { position: static; order: -1; }
            .ids-grid { grid-template-columns: 1fr; }
            .info-notices { margin-bottom: 20px; max-width: 100% !important; }
            .notice-item { flex-direction: row !important; padding: 10px !important; }
            .notice-text { font-size: 12px; opacity: 0.85 !important; max-height: none !important; }
            .notice-icon { font-size: 18px !important; }
        }
    </style>
</head>
<body>
    <header>
        <a href="" class="logo">
            <img src="img/SubGames.png" alt="Logo" class="logo-icon" onerror="this.style.display='none'">
            <span>SubGames</span>
        </a>
        <nav class="nav-desktop">
            <a href="baixar_manifest.html" class="active">Web</a>
            <a href="app_ou_plugin.html">App/Plugin</a>
            <a href="index.html">Atualiza√ß√µes</a>
            <a href="instrcoes.html">Como Baixar</a>
            <a href="suporte.html">Suporte</a>
        </nav>
        <div class="user-info">
            <div class="theme-toggle" onclick="toggleTheme()">
                <div class="theme-toggle-slider"></div>
            </div>
        </div>
        <div class="hamburger" onclick="toggleMenu()">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </header>
    <nav class="nav-mobile" id="mobileNav">
        <a href="web.html">Web</a>
        <a href="app_ou_plugin.html">App</a>
        <a href="index.html">Atualiza√ß√µes</a>
        <a href="instrucoes.html">Como Baixar</a>
        <a href="suporte.html">Suporte</a>
    </nav>
    <div class="main-content">
        <div class="content-left">
            <div class="page-header">
                <h1>Baixar Manifest</h1>
                <p>(Escreva o nome completo do jogo! Exemplo: n√£o escreva "GTA 5" escreva "Grand Theft Auto V Legacy")</p>
            </div>
            
            <div class="info-notices" style="margin-bottom: 24px;">
                <div class="notice-item">
                    <div class="notice-icon">ñ£ò</div>
                    <div class="notice-text">Estamos a criar os nossos pr√≥prios servidores. Nas pr√≥ximas atualiza√ß√µes iremos trazer mais jogos!</div>
                </div>
                <div class="notice-item">
                    <div class="notice-icon">üíö</div>
                    <div class="notice-text">Ainda n√£o temos sistema de doa√ß√£o pois, enquanto pudermos trazer tudo de gra√ßa, n√£o iremos precisar. S√≥ se as coisas apertarem financeiramente, mas entre no nosso <a href="https://discord.gg/h2WB7QVbZH" target="_blank" class="discord-link">Discord</a> para nos dar apoio!</div>
                </div>
            </div>
            
            <div class="search-bar">
                <input type="text" class="search-input" id="searchInput" placeholder="Pesquisar por nome ou ID...">
            </div>
            <div class="categories-section">
                <div class="categories-scroll" id="categoriesContainer"></div>
            </div>
            <div class="ids-grid" id="idsGrid"></div>
        </div>
        <aside class="sidebar">
            <div class="popular-section collapsed" id="popularSection">
                <div class="popular-header" onclick="togglePopularList()">
                    <div class="popular-title">Jogos em Destaque</div>
                    <div class="toggle-arrow">‚óÄ</div>
                </div>
                <div class="popular-content">
                    <div class="popular-list-grid" id="popularList"></div>
                </div>
            </div>
        </aside>
    </div>
    <footer>¬© 2025 SubGames</footer>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    <script>
        const { createClient } = supabase;
        const supabaseUrl = 'https://gcaqsrpmhiahvteehfgd.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdjYXFzcnBtaGlhaHZ0ZWVoZmdkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMTExMTksImV4cCI6MjA3ODY4NzExOX0.3VVPEf_huTNP_RvhlQ4WDl5VBKSiScov6ZY8oXekQHQ';
        const supabaseClient = createClient(supabaseUrl, supabaseKey);
        const searchInput = document.getElementById('searchInput');
        const idsGrid = document.getElementById('idsGrid');
        const popularList = document.getElementById('popularList');
        const categoriesContainer = document.getElementById('categoriesContainer');
        let allZips = [];
        let downloadCounts = {};
        let selectedCategory = 'all';

        const categoryKeywords = {
            'A√ß√£o': ['action', 'combat', 'fight', 'war', 'warfare', 'battlefield', 'shoot', 'shooter', 'gun', 'weapon', 'call of duty', 'cod', 'counter strike'],
            'Aventura': ['adventure', 'quest', 'tomb raider', 'uncharted', 'assassin', 'witcher', 'red dead'],
            'RPG': ['rpg', 'role playing', 'fantasy', 'elder scrolls', 'skyrim', 'fallout', 'dragon age'],
            'Estrat√©gia': ['strategy', 'tactical', 'civilization', 'total war', 'age of empires', 'xcom'],
            'Corrida': ['racing', 'race', 'forza', 'gran turismo', 'need for speed', 'nfs'],
            'Esporte': ['sport', 'fifa', 'nba', 'nfl', 'football', 'soccer', 'basketball'],
            'Simula√ß√£o': ['simulator', 'simulation', 'sims', 'farming', 'truck', 'flight'],
            'Terror': ['horror', 'resident evil', 'silent hill', 'outlast', 'dead space'],
            'Sobreviv√™ncia': ['survival', 'minecraft', 'rust', 'ark', 'forest', 'subnautica']
        };

        function detectCategory(gameName) {
            const nameLower = gameName.toLowerCase();
            const categories = [];
            for (const [category, keywords] of Object.entries(categoryKeywords)) {
                for (const keyword of keywords) {
                    if (nameLower.includes(keyword) && !categories.includes(category)) {
                        categories.push(category);
                        break;
                    }
                }
            }
            return categories.length === 0 ? ['Outros'] : categories;
        }

        async function loadAllZips() {
            try {
                idsGrid.innerHTML = '<div class="loading">üéÆ Carregando jogos...</div>';
                const { data: files, error } = await supabaseClient.storage.from('games').list('', { limit: 1000, sortBy: { column: 'name', order: 'asc' } });
                if (error) throw error;
                if (!files || files.length === 0) { idsGrid.innerHTML = '<div class="error">‚ùå Nenhum arquivo encontrado</div>'; return; }
                const zipFiles = files.filter(file => file.name && file.name.endsWith('.zip'));
                if (zipFiles.length === 0) { idsGrid.innerHTML = '<div class="error">‚ùå Nenhum arquivo .zip encontrado</div>'; return; }
                allZips = zipFiles.map((file, index) => {
                    const { data: urlData } = supabaseClient.storage.from('games').getPublicUrl(file.name);
                    const steamIdMatch = file.name.match(/_(\d{4,7})(?:\.zip)?$/);
                    const steamId = steamIdMatch ? steamIdMatch[1] : null;
                    let nameWithoutExt = file.name.replace('.zip', '').replace(/_\d+$/, '').replace(/_/g, ' ');
                    let imageUrl = steamId ? `https://cdn.akamai.steamstatic.com/steam/apps/${steamId}/header.jpg` : null;
                    const categories = detectCategory(nameWithoutExt);
                    return { id: file.id || `file-${index}`, name: nameWithoutExt, steamId: steamId, imageUrl: imageUrl, file_url: urlData.publicUrl, description: file.metadata?.size ? `${(file.metadata.size / 1024 / 1024).toFixed(2)} MB` : '', categories: categories, category: categories[0] };
                });
                renderCategories();
                renderZips(allZips);
                loadDownloadCounts();
                renderPopularGames();
            } catch (error) {
                idsGrid.innerHTML = `<div class="error">‚ùå Erro ao carregar jogos: ${error.message}</div>`;
            }
        }

        function renderCategories() {
            const categoryCounts = {};
            let totalGames = allZips.length;
            allZips.forEach(zip => { zip.categories.forEach(cat => { categoryCounts[cat] = (categoryCounts[cat] || 0) + 1; }); });
            const sortedCategories = Object.entries(categoryCounts).sort((a, b) => b[1] - a[1]);
            categoriesContainer.innerHTML = `<div class="category-chip ${selectedCategory === 'all' ? 'active' : ''}" onclick="filterByCategory('all')">Todos <span class="category-count">(${totalGames})</span></div>` + sortedCategories.map(([category, count]) => `<div class="category-chip ${selectedCategory === category ? 'active' : ''}" onclick="filterByCategory('${escapeHtml(category)}')">${escapeHtml(category)} <span class="category-count">(${count})</span></div>`).join('');
        }

        window.filterByCategory = function(category) {
            selectedCategory = category;
            renderCategories();
            if (category === 'all') { renderZips(allZips); } else { const filtered = allZips.filter(zip => zip.categories.includes(category)); renderZips(filtered); }
            searchInput.value = '';
        }

        function renderZips(zipsToRender = allZips) {
            if (zipsToRender.length === 0) { idsGrid.innerHTML = '<div class="no-results">üîç Nenhum resultado encontrado</div>'; return; }
            idsGrid.innerHTML = '';
            zipsToRender.forEach(zip => {
                const card = document.createElement('div');
                card.className = 'id-card';
                card.onclick = () => downloadZip(zip.file_url, zip.name);
                const imageHtml = zip.imageUrl ? `<img src="${zip.imageUrl}" alt="${escapeHtml(zip.name)}" class="game-image" onerror="this.style.display='none'">` : '';
                card.innerHTML = `${imageHtml}<div class="card-content"><div class="id-name">${escapeHtml(zip.name)}</div><div class="id-number">ID: ${zip.steamId || 'N/A'}</div><div>${zip.categories.map(cat => `<div class="category-badge">${escapeHtml(cat)}</div>`).join(' ')}</div>${zip.description ? `<div class="id-description">${escapeHtml(zip.description)}</div>` : ''}<div class="download-label">‚¨áÔ∏è Clique para baixar</div></div>`;
                idsGrid.appendChild(card);
            });
        }

        function filterZips() {
            const searchTerm = searchInput.value.toLowerCase();
            if (!searchTerm.trim()) {
                if (selectedCategory === 'all') { renderZips(allZips); } else { const filtered = allZips.filter(zip => zip.categories.includes(selectedCategory)); renderZips(filtered); }
                return;
            }
            let filtered = allZips.filter(zip => zip.name.toLowerCase().includes(searchTerm) || (zip.description && zip.description.toLowerCase().includes(searchTerm)) || (zip.steamId && zip.steamId.toString().includes(searchTerm)) || zip.categories.some(cat => cat.toLowerCase().includes(searchTerm)));
            if (selectedCategory !== 'all') { filtered = filtered.filter(zip => zip.categories.includes(selectedCategory)); }
            renderZips(filtered);
        }

        function downloadZip(url, name) {
            const gameName = name.trim();
            downloadCounts[gameName] = (downloadCounts[gameName] || 0) + 1;
            saveDownloadCounts();
            renderPopularGames();
            const link = document.createElement('a');
            link.href = url;
            link.download = name + '.zip';
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function loadDownloadCounts() {
            const saved = localStorage.getItem('downloadCounts');
            if (saved) { try { downloadCounts = JSON.parse(saved); } catch (e) { downloadCounts = {}; } }
        }

        function saveDownloadCounts() {
            localStorage.setItem('downloadCounts', JSON.stringify(downloadCounts));
        }

        function renderPopularGames() {
            const popularListGrid = document.getElementById('popularList');
            const shuffled = [...allZips].sort(() => Math.random() - 0.5);
            const featured = shuffled.slice(0, 7);
            if (featured.length === 0) { popularListGrid.innerHTML = '<div style="color: var(--secondary-text); font-size: 12px; padding: 8px 0;">Nenhum jogo dispon√≠vel</div>'; return; }
            popularListGrid.innerHTML = featured.map((game, index) => {
                const imageHtml = game.imageUrl ? `<img src="${game.imageUrl}" class="popular-image" onerror="this.style.display='none'">` : '';
                const rank = index + 1;
                return `<div class="popular-item" onclick="downloadZip('${game.file_url}', '${escapeHtml(game.name)}')"><div class="popular-rank">${rank}</div>${imageHtml}<div class="popular-info"><div class="popular-name">${escapeHtml(game.name)}</div><div class="popular-downloads">${game.categories[0] || 'Jogo'}</div></div></div>`;
            }).join('');
        }

        window.togglePopularList = function() {
            const section = document.getElementById('popularSection');
            section.classList.toggle('collapsed');
            localStorage.setItem('popularCollapsed', section.classList.contains('collapsed'));
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        window.toggleTheme = function() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        window.toggleMenu = function() {
            document.querySelector('.hamburger').classList.toggle('active');
            document.getElementById('mobileNav').classList.toggle('active');
        }

        // Inicializa√ß√£o
        if (localStorage.getItem('theme') === 'dark') { 
            document.body.classList.add('dark-mode'); 
        }
        
        if (localStorage.getItem('popularCollapsed') === 'true') {
            document.getElementById('popularSection').classList.add('collapsed');
        }

        // Event listener para pesquisa
        searchInput.addEventListener('input', filterZips);

        // Carregar jogos ao iniciar
        loadAllZips();
    </script>
</body>
</html>